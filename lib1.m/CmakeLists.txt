cmake_minimum_required(VERSION 3.15.0)
project(lib1.m)

# compile definitions
add_library(lib1_obj OBJECT src/lib1help.cpp)
target_include_directories(lib1_obj PUBLIC include/)
target_include_directories(lib1_obj PRIVATE $<TARGET_PROPERTY:lib2_obj,INCLUDE_DIRECTORIES>)
target_compile_definitions(lib1_obj PRIVATE __LIB1)


add_custom_target(lib1_light COMMAND "lib /def")


# # Link1st with shared incomplete lib
# add_library(lib1_light SHARED $<TARGET_OBJECTS:lib1_obj>)
# target_include_directories(lib1_light PUBLIC include/)
# set_target_properties(lib1_light PROPERTIES OUTPUT_NAME lib1)
# target_link_options(lib1_light PRIVATE -Xlinker /force:unresolved)
# install(TARGETS lib1_light ARCHIVE DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)

# # Link2nd with all symbols
# add_library(lib1_full SHARED $<TARGET_OBJECTS:lib1_obj>)
# target_link_libraries(lib1_full PRIVATE lib2_light)
# install(TARGETS lib1_full RUNTIME DESTINATION ${CMAKE_INSTALL_PREFIX}/bin RENAME lib1)
