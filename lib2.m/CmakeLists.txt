cmake_minimum_required(VERSION 3.15.0)
project(lib2.m)

# compile definitions
add_library(lib2_obj OBJECT src/lib2help.cpp)
target_include_directories(lib2_obj PUBLIC include/)
target_include_directories(lib2_obj PRIVATE $<TARGET_PROPERTY:lib1_obj,INCLUDE_DIRECTORIES>)
target_compile_definitions(lib2_obj PRIVATE __LIB2)

# Link1st with shared incomplete lib
add_library(lib2_light SHARED $<TARGET_OBJECTS:lib2_obj>)
target_include_directories(lib2_light PUBLIC include/)
set_target_properties(lib2_light PROPERTIES OUTPUT_NAME lib2)
target_link_options(lib2_light PRIVATE -Xlinker /force:unresolved)
install(TARGETS lib2_light ARCHIVE DESTINATION ${CMAKE_INSTALL_PREFIX}/lib)

# Link2nd with all symbols
add_library(lib2_full SHARED $<TARGET_OBJECTS:lib2_obj>)
target_link_libraries(lib2_full PRIVATE lib1_light)
install(TARGETS lib2_full RUNTIME DESTINATION ${CMAKE_INSTALL_PREFIX}/bin)
